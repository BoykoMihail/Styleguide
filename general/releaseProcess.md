# Процесс осуществления внешних поставок

Внешние поставки могут быть двух видов:

1. Поставка клиенту
2. Поставка в стор

## Поставка клиенту

Для поставки клиенту необходимо выполнить следующие шаги:

1. Разработчик поднимает версию приложения, если необходимо
2. Разработчик ставит сборку в TeamCity с галочкой UPLOAD\_TO\_FABRIC
3. После успешной сборки тестировщик проводит тест миграции на stage сервере
4. Параллельно менеджер проводит [PM-preview](https://github.com/TouchInstinct/Styleguide/blob/master/qa/releaseCandidatReview.md)
5. В случае найденных проблем разработчик устраняет проблемы и возвращается на шаг 2
6. После того, как менеджер и [тестировщик](releaseManagement.md#одобрение-поставки-тестированием) одобрили поставку, необходимо добавить релиз тэг на тот коммит, с которого была собрана сборка
7. Менеджер шарит сборки заказчику

## Релиз в стор

Для релиза в стор необходимо выполнить следующие шаги:

1. Разработчик поднимает версию приложения, если необходимо
2. Разработчик создает merge request в мастер репозиторий проекта (подробней можно почитать в [гайде про гит](gitGuide.md)) и в [common репозиторий](commonRepo.md)
3. CI автоматически стартует сборку на продовском сервере с запуском статического анализатора кода и автотестов
4. Если все проверки прошли успешно, то разработчик ставит релизную сборку с флагом UPLOAD\_TO\_STORE. 
5. После успешной сборки разработчик загружает билд в TestFlight или в альфа тестирование в Google Play Console с описанием обновления и скриншотами, если необходимо. Описание скриншота и обновление нужно взять у менеджера.
6. После успешной загрузки билда разработчик мидла деплоит обновления сервера на prod окружение
7. После успешной сборки тестировщик проводит тест миграции на prod сервере
8. Менеджер проводит [PM-preview](https://github.com/TouchInstinct/Styleguide/blob/master/qa/releaseCandidatReview.md)
9. В случае найденных проблем разработчик устраняет проблемы, обновляет рабочую ветку и возвращается на шаг 3
10. После того, как менеджер и [тестировщик](releaseManagement.md#одобрение-поставки-тестированием) дали добро, Менеджер отправляет сборки на ревью с возможностью ручной выкладки
11. После успешного ревью 
    1. Менеджер или заказчик релизит приложение в стор
    2. Менеджер оповещают разработчиков о релизе. Разработчики мержат код в мастер
    3. Разработчики добавляют релиз тэг на коммит мержа
    4. (Опционально) Серверные разработчики отключают старые версии апи

## Релиз тэги

Тэг берется из [таблицы релизов](https://www.notion.so/de43a76af37b4497b4a6886ba2a0530e?v=a7bafcda543a4a36b8157e08f8e7047b), которую ведет релиз-менеджер.

Тэг добавляется на тот коммит, с которого была собрана сборка, которая уйдет в поставке. Тэг должен быть равен названию версии. 

Формат версии должен быть [семантическим](https://semver.org/) MAJOR.MINOR.PATCH-RELEASETYPE. Валидировать версию можно здесь: https://jubianchi.github.io/semver-check/#/version/1.0.1-rc.1 

Пример тэга - `1.4.10-rc.1`, `2.5.0-release`.
