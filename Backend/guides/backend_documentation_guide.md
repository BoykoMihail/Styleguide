## В данном документе сформулированы основные принципы создания документации для backend API.

* [Общие принципы построения API](#1-Общие-принципы-построения-API)
* [Именование методов](#2-Именование-методов)
* [Параметры запроса и ответа](#3-Параметры-запроса-и-ответа)
* [Описание ошибок](#4-Описание-ошибок)
* [Версионирование](#5-Версионирование)

## 1 Общие принципы построения API

#### 1.1. Протокол общения между сервером и клиентом 

HTTPS 

#### 1.2. Стиль построения API 

REST 

#### 1.3. Используемая кодировка 

UTF-8 

#### 1.4. Допустимые задержки 

Генерация ответа на сервере в среднем занимает меньше 1 секунды. 

#### 1.5. Передача параметров 

Параметры передаются в виде json-объекта в теле запроса.
Имена параметров в стиле CamelCase
Для всех запросов должен быть выставлен Content-Type: application/json.
Url Query String не содержит параметров. 

#### 1.6. Общии вид ответа сервера 

Результат вызова любого метода представляет собой JSON-объект следующей структуры: 


| Название поля | Тип поля | Описание | Обязательность |
| --- | --- | --- | --- |
| result        | object   | В случае ошибки содержит null. В случае успеха содержит результат вызова метода. | Да |
| errorCode     | int      | В случае ошибки содержит код ошибки 1..999. В случае успеха содержит 0. | Да |
| errorMessage  | string   | В случае ошибки содержит текстовое описание ошибки. В случае успеха содержит null. | Да |

Поля JSON-объекта в стиле CamelCase

Если endpoint меняет состояние объекта, то в ответе должен вернуться объект в актуальном состоянии. 

Пример

```
POST /user/update
{
    id: 1,
    firstName: 'Tim',
}

Response:
{
    errorCode: 0,
    errorMessage: null,
    result: {
        id: 1,
        firstName: 'Tim'
    }
}
```

## 2 Именование методов

Слеш `/` в конце пути должен игнорироваться.

Например:

`/user/info` и `/user/info/` должны вести на один и тот же контроллер.

#### 2.1 URL или структура URL (только путь, без корневого URL)

Пример: /user/info

В качестве первой части url всегда должна использоваться высокоуровневая сущность, которая будет объединять большое количество методов и представлять из себя подраздел документации серверного api.

Пример:

```
/user/login
```
Но не:
```
/login
```

Во второй части url может быть либо зависимая от первой части другая сущность, либо глагол с указанием действия производимого методом на основную сущность. Не более двух сущностей могут встречаться в одном url.

Пример:

```
/user/wallpaper/listing
```
Но не:

```
/user/guild/wallpaper/listing
```

Пример:

```
/user/guild/set
/user/guild/listing
```
Но не:

```
/user/set/guild
/user/listing/guild
```

#### 2.2 Ключевые слова используемые при составлении url.

Также в качестве базовых глаголов вводятся следующие понятия:

##### 2.2.1 Получения списка сущностей или получение сущности заданного типа с выбранными идентификаторами

```
get
```

Пример:

```
/user/wallpaper/get
```

Для получения списка сущностей указываются дополнительные параметры offset/limit. Для получения отдельных сущностей указываются список id.

##### 2.2.2 Установка значения выбранной сущности

```
set
```

Пример:

```
/user/wallpaper/set
```

##### 2.2.3 Создание новой сущности заданного типа.

```
create
```

Пример:

```
/user/wallpaper/create
```

##### 2.2.4 Удаление сущности заданного типа

```
delete
```

Пример:

```
/user/wallpaper/delete
```

## 3 Параметры запроса и ответа

#### 3.1 Описание параметров запроса и результата ответа

| Название параметра | Тип параметра | Описание | Обязательность |
| --- | --- | --- | --- |

В качестве типа параметра допускается использование простых типов: string (строка), int (целое число), double (число с запятой), bool (булевое значение). Также допускается использование структур, представляющих из себя словари и состоящих также из простых типов.

#### 3.2 Описание ключевых слов, используемых в качестве параметров запроса

Идентификатор сущности

```
id
```

Запрашиваемое число сущностей

```
limit
```

Сдвиг

```
offset
```

Указывает на сущности запрашиваемые после определенной

```
sinceId
```

Указывает на сущности запрашиваемые до определенной

```
tillId
```

Параметры limit & offset являются обязательными. Параметры sinceId & tillId являются опциональными и превносят вариативность в ответах и используются в следующих случаях:

а) Если указан только sinceId - это пагинация, начинающая с записи указанной в качестве sinceId

б) Если указан только tillId - это запрос записей выше указанной записи. При это если в ответе приходит массив размерностью limit, то на клиенте полностью дропается кэш.

в) Если не указаны sinceId и tillId - в этом случае возвращается верхняя страница.

г) Если указан и sinceId и tillId - в этом случае возвращается страницы между двумя записями.

##### 3.2.1 Сортировка

Сортировка описывается ключевым словом order

```
order
```

При этом список возможных сортировок задается перечислением.

#### 3.3 Описание ключевых слов, используемых в качестве результатов ответа

```
id
```
Идентификатор сущности
```
description
```
Описание сущности
```
totalCount
```
Общее число сущностей
```
tillCount
```
Общее число новый сущностей выше tillId

```
items
```
Список сущностей

##### 3.3.1 Перечисления

Перечисления в ответе помечается специальным постфиксом State или Type

Пример:

```
SeasonState   или   NotificationType
```

##### 3.3.2 Ключевые постфиксы

Если значение является датой, то добавляется постфикс Date:

Пример:
```
startDate
```

Если значение является url, то добавляется постфикс Url:

Пример:
```
bigImageUrl
```

## 4 Описание ошибок

#### 4.1 Описание ошибок сервера

Ошибки описываются отдельно с определенными недублирующимися целыми (int) значениями. В описании результатов ответа к запросам даются ссылки на возможный код ошибки.

## 5 Версионирование 

#### 5.1 Описание системы версионирования

Версия документации должна совпадать с версией на сервере полностью.

Текущая версия указывается напрямую в url после домена.

Пример:

```
www.touchin.ru/v1/user/listing
```

#### 5.2 Описание изменений по сравнению с предыдущей версией

Каждая новая версия документации должна содержать список с описанием изменений по сравнению с предыдущей версией.

#### 5.3 Инкремент версий
Версия API содержит только мажорный номер.
Мажорный номер повышается, только если новая версия API содержит изменения, делающие его несовместимым с клиентами, которые в данный момент находятся в проде.  
При начальной разработке версионирование API начинается от 0. В релиз уходит версия 1.
При выпуске новой версии API с мажорным номером крайне желательно сохранить старую, чтобы предыдущие клиенты продолжали работать.  
При доработках API в рамках готовящегося релиза мажорная версия повышается максимум один раз. Минорная версия повышается для подчеркивания изменений.  
Повышение мажорной версии API должно быть привязано к выпуску новой версии клиентов, которые с ней работают.  
